(function(){var t,e,n,i,o,h,s={}.hasOwnProperty,r=function(t,e){function n(){this.constructor=t}for(var i in e)s.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a=[].slice;e=this.Spine||require("spine"),t=e.$,i=/^#*/,o=/:([\w\d]+)/g,h=/\*([\w\d]+)/g,n=/[-[\]{}()+?.,\\^$|#\s]/g,e.Route=function(s){function u(t,e){var i;if(this.path=t,this.callback=e,this.names=[],"string"==typeof t){for(o.lastIndex=0;null!==(i=o.exec(t));)this.names.push(i[1]);for(h.lastIndex=0;null!==(i=h.exec(t));)this.names.push(i[1]);t=t.replace(n,"\\$&").replace(o,"([^/]*)").replace(h,"(.*?)"),this.route=new RegExp("^"+t+"$")}else this.route=t}var p;return r(u,s),u.extend(e.Events),u.historySupport=null!=(null!=(p=window.history)?p.pushState:void 0),u.routes=[],u.options={trigger:!0,history:!1,shim:!1},u.add=function(t,e){var n,i,o;if("object"!=typeof t||t instanceof RegExp)return this.routes.push(new this(t,e));o=[];for(n in t)i=t[n],o.push(this.add(n,i));return o},u.setup=function(e){return null==e&&(e={}),this.options=t.extend({},this.options,e),this.options.history&&(this.history=this.historySupport&&this.options.history),this.options.shim?void 0:(this.history?t(window).bind("popstate",this.change):t(window).bind("hashchange",this.change),this.change())},u.unbind=function(){return this.options.shim?void 0:this.history?t(window).unbind("popstate",this.change):t(window).unbind("hashchange",this.change)},u.navigate=function(){var e,n,i,o;return e=1<=arguments.length?a.call(arguments,0):[],i={},n=e[e.length-1],"object"==typeof n?i=e.pop():"boolean"==typeof n&&(i.trigger=e.pop()),i=t.extend({},this.options,i),o=e.join("/"),this.path===o||(this.path=o,this.trigger("navigate",this.path),i.trigger&&this.matchRoute(this.path,i),i.shim)?void 0:this.history?history.pushState({},document.title,this.path):window.location.hash=this.path},u.getPath=function(){var t;return t=window.location.pathname,"/"!==t.substr(0,1)&&(t="/"+t),t},u.getHash=function(){return window.location.hash},u.getFragment=function(){return this.getHash().replace(i,"")},u.getHost=function(){return(document.location+"").replace(this.getPath()+this.getHash(),"")},u.change=function(){var t;return t=this.history?this.getPath():this.getFragment(),t!==this.path?(this.path=t,this.matchRoute(this.path)):void 0},u.matchRoute=function(t,e){var n,i,o,h;for(h=this.routes,i=0,o=h.length;o>i;i++)if(n=h[i],n.match(t,e))return this.trigger("change",n,t),n},u.prototype.match=function(t,e){var n,i,o,h,s,r;if(null==e&&(e={}),i=this.route.exec(t),!i)return!1;if(e.match=i,h=i.slice(1),this.names.length)for(n=s=0,r=h.length;r>s;n=++s)o=h[n],e[this.names[n]]=o;return this.callback.call(null,e)!==!1},u}(e.Module),e.Route.change=e.Route.proxy(e.Route.change),e.Controller.include({route:function(t,n){return e.Route.add(t,this.proxy(n))},routes:function(t){var e,n,i;i=[];for(e in t)n=t[e],i.push(this.route(e,n));return i},navigate:function(){return e.Route.navigate.apply(e.Route,arguments)}}),"undefined"!=typeof module&&null!==module&&(module.exports=e.Route)}).call(this);